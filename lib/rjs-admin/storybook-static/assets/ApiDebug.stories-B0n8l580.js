import{j as e}from"./jsx-runtime-BjG_zV1W.js";import{r as d}from"./iframe-4KYKMOYs.js";import{A as l,f as u,e as x,c as y}from"./api-B9Cd0jbc.js";import{B as w}from"./Button-eyc4dcTo.js";const P={title:"Debug/API Proxy Test",parameters:{layout:"padded",docs:{description:{component:"Debug component to test API proxy configuration and identify any issues with direct localhost:8000 calls."}}},tags:["autodocs"]},v=()=>{const[o,i]=d.useState([]),[a,c]=d.useState(!1),r=(t,s,b)=>{i(j=>[...j,{test:t,status:s,details:b}])},h=async()=>{c(!0),i([]),r("API Base URL","info",l);const t=y("_meta/idm.user");r("URL Creation","info",`_meta/idm.user → ${t}`);try{console.log("🧪 Debug: Testing user metadata fetch...");const s=await u(x.userMetadata());r("User Metadata (/api proxy)","success",`Received ${Object.keys(s).length} properties`)}catch(s){r("User Metadata (/api proxy)","error",s instanceof Error?s.message:"Unknown error")}try{console.log("🧪 Debug: Testing direct localhost:8000 call...");const s=await fetch("http://localhost:8000/_meta/idm.user");s.ok?(await s.json(),r("Direct localhost:8000","warning","Direct call succeeded - this might cause issues in Storybook")):r("Direct localhost:8000","expected",`Failed as expected: ${s.status}`)}catch{r("Direct localhost:8000","expected","Failed as expected - CORS or network error")}try{console.log("🧪 Debug: Testing organization metadata fetch...");const s=await u(x.organizationMetadata());r("Organization Metadata (/api proxy)","success",`Received ${Object.keys(s).length} properties`)}catch(s){r("Organization Metadata (/api proxy)","error",s instanceof Error?s.message:"Unknown error")}c(!1)},f=t=>{switch(t){case"success":return"text-green-600 bg-green-50";case"error":return"text-red-600 bg-red-50";case"warning":return"text-orange-600 bg-orange-50";case"expected":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"🔍 API Proxy Debug Tool"}),e.jsxs("p",{className:"text-blue-800 text-sm",children:["This tool tests the API proxy configuration to ensure all requests go through ",e.jsx("code",{children:"/api"}),"instead of directly to ",e.jsx("code",{children:"localhost:8000"}),". Make sure your backend server is running on port 8000."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Test Results"}),e.jsx(w,{onClick:h,disabled:a,children:a?"Running Tests...":"Run API Tests"})]}),e.jsxs("div",{className:"space-y-2",children:[o.length===0&&!a&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'Click "Run API Tests" to start debugging'}),a&&e.jsx("div",{className:"text-center py-4",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Running tests..."]})}),o.map((t,s)=>e.jsxs("div",{className:`p-3 rounded border ${f(t.status)}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("strong",{children:t.test}),e.jsx("span",{className:"text-xs uppercase tracking-wider font-medium",children:t.status})]}),e.jsx("pre",{className:"text-xs mt-1 overflow-x-auto",children:typeof t.details=="string"?t.details:JSON.stringify(t.details,null,2)})]},s))]}),e.jsxs("div",{className:"p-4 bg-gray-50 border rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Environment Info"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Window Location:"})," ",typeof window<"u"?window.location.href:"Server-side"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Port:"})," ",typeof window<"u"?window.location.port:"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Hostname:"})," ",typeof window<"u"?window.location.hostname:"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"API Base URL:"})," ",e.jsx("code",{children:l})]})]})]})]})},n={render:()=>e.jsx(v,{})};var g,m,p;n.parameters={...n.parameters,docs:{...(g=n.parameters)==null?void 0:g.docs,source:{originalSource:`{
  render: () => <ApiDebugComponent />
}`,...(p=(m=n.parameters)==null?void 0:m.docs)==null?void 0:p.source}}};const T=["ProxyDebugTest"];export{n as ProxyDebugTest,T as __namedExportsOrder,P as default};
